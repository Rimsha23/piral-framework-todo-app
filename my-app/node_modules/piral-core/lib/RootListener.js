"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.RootListener = void 0;
const tslib_1 = require("tslib");
const React = tslib_1.__importStar(require("react"));
const react_dom_1 = require("react-dom");
const hooks_1 = require("./hooks");
const modules_1 = require("./modules");
const RootListener = () => {
    const context = (0, hooks_1.useGlobalStateContext)();
    React.useLayoutEffect(() => {
        if (typeof document !== 'undefined') {
            const renderHtml = (ev) => {
                ev.stopPropagation();
                const { target, props } = ev.detail;
                const [dispose, update] = (0, modules_1.renderElement)(context, target, props);
                target.dispose = dispose;
                target.update = update;
            };
            const renderContent = (ev) => {
                ev.stopPropagation();
                const { target, content, portalId } = ev.detail;
                const portal = (0, react_dom_1.createPortal)(content, target);
                const dispose = () => context.hidePortal(portalId, portal);
                context.showPortal(portalId, portal);
                target.dispose = dispose;
            };
            document.body.addEventListener('render-html', renderHtml, false);
            window.addEventListener('render-content', renderContent, false);
            return () => {
                document.body.removeEventListener('render-html', renderHtml, false);
                window.removeEventListener('render-content', renderContent, false);
            };
        }
    }, [context]);
    return null;
};
exports.RootListener = RootListener;
//# sourceMappingURL=RootListener.js.map